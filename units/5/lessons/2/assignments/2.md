[//]: <> (name: Create a Song Management API)
[//]: <> (author: Joe Turner)
[//]: <> (type: code from scratch)
[//]: <> (time: 3 hours)

# Creating a song management API

In this assignment you are going to be creating a basic API for storing and retreiving songs for the application.

**TODO**: Add URL for repo

So we can get started as quickly as possible there is already a frontend for the project and a basic framework for your code available from [this Git repository](https://github.com/WHAT).  To get started you should:

1. Create a clone of the repository (`git clone WHAT`)
2. Move into the project's directory (`cd WHAT`)
3. Set up a virtualenv for the project (`virtualenv env`)
4. Activate the virtualenv (`source env/bin/activate`)
5. Install the project's dependencies (`pip install -r requirements.txt`)

Try running the app using `python run.py`.  If you visit the index URL you should see a basic (but non-functioning) user interface.  Try opening up the developer console.  You should see that the frontend is failing to complete its requests to the API.  Let's start building our simple song management API to fix that.  This can be split down into three tasks.

## The database

In the file *chords/models.py* we are going to need two SQLAlchemy models.

1. The Song model: This should have an integer id column, and a column specifying a one-to-one relationship with a File.
2. The File model: This should have an integer id column, a string column for the file name, and the backref from the one-to-one relationship with the Song.

Each model should have an `as_dictionary` method.  The `Song.as_dictionary` method should a dictionary which looks something like this:

```python
{
    "id": 1,
    "file": {
        "id": 7,
        "name": "Shady_Grove.mp3"
    }
}
```

The `File.as_dictionary` method should just return the `file` element of the song dictionary (i.e. `{"id": 7, "name": "Shady_Grove.mp3"}`).

Try to create those two models, and use Python's interactive interpreter to experiment with adding Song and Files and creating relationships between them.

## The GET endpoint

In the *chords/api.py* file we need a GET endpoint for `/songs` which returns a list of all of the songs as JSON.  Try to follow the practice laid out in the previous lesson as you create this, adding tests as you go and trying to make your endpoint well behaved to clients.

## The POST endpoint

In the *chords/api.py* file add a POST endpoint for `/songs` which allows you to add a new song to the database.  The endpoint should look for JSON POST data in the following format:

```json
{
    "file": {
        "id": 7
    }
}
```

You should use the file ID to make sure that the file exists in the database, and make the relationship with your new song.  Again you should try to follow the good practice for working with POST data, and write tests to make sure that your endpoint is working as you expect.

## Testing it out

Now that you have the beginning of an API try adding a couple of example `File` and `Song` object to the database from the interactive Python interpreter and then visit the frontend.  You should be able to see the songs listed in the left column of the site.

While you are in the frontend, try adding a song using the `Add Song` button.  You should see a failed request to the `/api/files` endpoint in the console as it tries to upload the file.  In the next assignment we will be looking at how file upload works on a single-page web app and writing the endpoints to get this up and running on our site.

## Extension task

Add PUT and DELETE endpoints to your API allowing you to edit and delete songs from the app.

